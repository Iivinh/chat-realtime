# Cáº¥u hÃ¬nh worker processes
user nginx;
worker_processes auto;

events {
    worker_connections 1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    # ğŸŸ¢ Äá»ŠNH NGHÄ¨A UPSTREAM (CÃC SERVER BACKEND)
    upstream backend_servers {
        # Docker Compose sáº½ tá»± Ä‘á»™ng táº¡o host cho má»—i replica: backend_1, backend_2, v.v.
        # Sá»­ dá»¥ng tÃªn dá»‹ch vá»¥ lÃ  Ä‘á»§
        server backend:5000;
    }

    server {
        listen 80; # Nginx láº¯ng nghe cá»•ng 80 ná»™i bá»™
        location / {
            # Báº­t proxy header Ä‘á»ƒ gá»­i Ä‘Ãºng Ä‘á»‹a chá»‰ client
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $host;

            # ğŸŸ¢ CÃ‚N Báº°NG Táº¢I: Chuyá»ƒn hÆ°á»›ng traffic Ä‘áº¿n upstream (cÃ¡c container backend)
            proxy_pass http://backend_servers; 

            # Cáº¥u hÃ¬nh cho Socket.IO (Äá»ƒ giao thá»©c WebSocket hoáº¡t Ä‘á»™ng)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }
}